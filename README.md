# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Данные и типы данных используемые в приложении

Карточка товара

```
interface IProduct {
	id: string;
	description: string;
	title: string;
	image: string;
	category: string;
	price: number;
	index: number;
}
```

Корзина

```
interface IBasket {
	products: HTMLElement[];
	totalPrice: number | null;
	counter: number;
}  
```

Оформление заказа

```
interface IOrder {
	payment: string;
	address: string;
	email: string;
	phone: string;
	total: number;
	items: string[];
}
```

Успешный заказ

```
interface IOrderResult {
	id: string;
}
```

Вид страницы

```
interface IPage {
	counter: number;
	catalog: HTMLElement[];
	locked: boolean;
}
```

Cтраницы магазина

```
interface IAppState {
	catalog: IProduct[];
	basket: string[];
	preview: string | null;
	order: IOrder | null;
	basketCounter: number;
}
```

Api

```
interface IApi {
	getProducts: () => Promise<IProduct[]>;
	orderProducts(order: IOrder): Promise<IOrderResult>;
}
```

Сосотояние формы

```
interface IForm {
	valid: boolean;
	errors: string[];
}
```

Оформление заказа

```
type TOrder = Pick<IOrder, 'payment' | 'address' | 'email' | 'phone'>;
```

Ошибки в форме

```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```


## Архетиктура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления отвечает за отображение данных на странице
- слой данных отвечает за хранение и изменение данных
- презентер отвечает за связь представления и данных

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Абстрактный класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Абстрактный класс Model
Класс представляет базовую модель, которая может использоваться для создания конкретных моделей с различным содержимым и функционалом.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. 

#### Класс Form
Класс обеспечивает управление формами, включая обработку событий отправки и изменения данных, управление состоянием формы (валидность и ошибки) и рендеринг формы с обновленными данными.


### Слой данных

#### Класс AppState
Класс управляет состоянием приложения, включая данные о товарах, корзине и заказе. Он предоставляет методы для изменения состояния, выполнения валидации форм и эмитирования событий.\
Содержит в себе сеттеры и геттеры для товаров, заказа, корзины и id товара для предварительного просмотра.
Поля класса:
- _products - массив товаров
- _order - объект с информацией для оформления заказа
- _basket - массив товаров в корзине
- _preview - id товара для просмотра
- events - для работы с событиями
- formErrors - объект для хранения ошибок форм

Методы:
- getProduct(cardId: string) - метод для получения товара по id
- clearBasket() - метод для очистки корзины
- addToBasket(product: IProduct) - метод для добавления продукта в корзину
- deleteFromBasket(product: IProduct) - метод для удаления продукта из корзины
- setTotal - метод для установки общей стоимости товаров в корзине
- validateOrderForm() - метод для валидации формы заказа
- validateContactsForm() - метод для валидации контактной информации
- setOrderField(field: keyof TOrder, value: string) - метод для обновления поля в заказе и проверки правильности формы


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Класс управляет отображением и поведением элементов страницы в пользовательском интерфейсе. Имееет сеттеры для установки счетчика корзины, каталога и блокировки/разблокировки страницы.

#### Класс ProductCard
Класс отвечает за визуальное представление информации о товаре: заголовок, изображение, описание, цена, категория. Также он обрабатывает клики на кнопки. Имеет сеттеры и геттеры для представления информации.

#### Класс Basket
Класс отвечает за отображение и управление корзиной покупок в пользовательском интерфейсе. Имеет сеттеры для установки товаров в корзине, общей стоимости и состояния кнопки оформления заказа.

#### Класс OrderForm
Класс управляет отображением и поведением формы заказа в пользовательском интерфейсе.
Добавляет обработчики событий для кнопок оплаты, которые переключают активное состояние кнопок и устанавливают тип оплаты. Имеет сеттер для установки адреса.
Методы:
- toggleCardButton(state: boolean = true) - метод для переключения состояния кнопки оплаты картой
- toggleCashButton(state: boolean = true) - метод для переключения состояния кнопки оплаты наличными
- setPayment(button: HTMLButtonElement) - метод для установки типа оплаты

#### Класс ContactForm
Класс отвечает за отображение и управление формой контактов в пользовательском интерфейсе. Имеет сеттеры для установки значения почты и телефона.

#### Класс Success
Класс отвечает за визуальное отображение успешного завершения заказа, включая общую сумму заказа и кнопку закрытия уведомления. А также сеттер установки суммы успешного заказа.


### Слой коммуникации

#### Класс AppApi
Класс представляет собой интерфейс для взаимодействия с внешним API. Он расширяет базовый класс Api и реализует интерфейс IApi. 


## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных):*
- `products:changed` - изменение массива карточек товара
- `product:selected` - откраваем выбраную карточку товара

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `product:add` - добавление товара
- `product:delete` - удаление товара
- `basket:open` - открытие корзины
- `payment:selected` - выбор способа оплаты
- `order-form:open` - открытие формы с заказом
- `form-errors:change` - сообщений об ошибках ввода
- `order:submit` - сохранение данных пользователя в модальном окне
- `contacts:submit` - сохранение данных пользователя в модальном окне и оформления заказа


